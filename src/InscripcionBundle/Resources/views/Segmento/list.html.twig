{% extends 'CommonBundle::layout.html.twig' %}

{% block contenidoToolbar %}
    <div class="toolbar row">
        <div class="col-sm-6 hidden-xs">
            <div class="page-header">
                <h1><i class="fa fa-list-ol"></i> Listado de Segmentos <small>Todo lo referido a los segmentos de inscripción</small></h1>
            </div>
        </div>
        <div class="col-sm-6 col-xs-12">
            <div class="toolbar-tools pull-right">
                <!-- start: TOP NAVIGATION MENU -->
                <ul class="nav navbar-right">
                    <!-- start: TO-DO DROPDOWN -->
                    <!--<li class="dropdown">
                        <a  href="{{ path('inscripcion')}}" >
                            <i class="fa fa-arrow-left"></i> VOLVER
                        </a>
                    </li>-->
                    {#% if is_granted('ROLE_INSCRIPCION_NEW') %#}
                        <li class="dropdown">
                            <a  href="#1" onclick="$.Segmento.newModal('{{path('segmento_new')}}')">
                                <i class="fa fa-user"></i> NUEVO
                            </a>
                        </li>
                    {#% endif %#}
                </ul>
                <!-- end: TOP NAVIGATION MENU -->
            </div>
        </div>
    </div>
{% endblock %}
{% block contenidoBreadcrumb %}
    <div class="row">
        <div class="col-md-12">
            <ol class="breadcrumb">
                <li>
                    <a href="{{ path('homepage') }}">
                        <i class="fa fa-home" aria-hidden="true"></i>
                    </a>
                </li>                 
                <li>
                    <a href="{#{ path('inscripcion') }#}">
                        Inscripción
                    </a>
                </li>
                <li class="active">
                    Segmentos
                </li>
            </ol>
        </div>
    </div>
{% endblock %}
{% block contenidoData %}
    <div class="panel-heading">
        <h4 class="panel-title">Tabla <span class="text-bold">de inscriptos en : {#{ evento.nombreCompleto }#}</span></h4>
        <div class="panel-tools">
            <div class="dropdown">
                <a data-toggle="dropdown" class="btn btn-xs dropdown-toggle btn-transparent-grey">
                    <i class="fa fa-cloud-download"></i>
                </a>
                <!--<ul class="dropdown-menu dropdown-light pull-right" role="menu">
                    <li>
                        <a href="#1" class="export-csv">
                            <i class="fa fa-file-text-o"></i> Guardar como CSV
                        </a>
                    </li>
                    <li>
                        <a href="#1" class="export-txt">
                            <i class="fa fa-file-text-o"></i> Guardar como TXT
                        </a>
                    </li>
                    <li>
                        <a href="#1" class="export-sql">
                            <i class="fa fa-file-text-o"></i> Guardar como SQL
                        </a>
                    </li>
                    <li>
                        <a href="#1" class="export-json">
                            <i class="fa fa-file-text-o"></i> Guardar como JSON
                        </a>
                    </li>
                    <li>
                        <a href="#1" class="export-excel">
                            <i class="fa fa-file-text-o"></i> Exportar como Excel
                        </a>
                    </li>
                    <li>
                        <a href="#1" class="export-doc">
                            <i class="fa fa-file-text-o"></i> Exportar como Word
                        </a>
                    </li>
                </ul>-->
            </div>
            <div class="dropdown">
                <a data-toggle="dropdown" class="btn btn-xs dropdown-toggle btn-transparent-grey">
                    <i class="fa fa-cog"></i>
                </a>
                <ul class="dropdown-menu dropdown-light pull-right" role="menu">
                    <li>
                        <a class="panel-collapse collapses" href="#">
                            <i class="fa fa-angle-up"></i> <span>Minimizar</span>
                        </a>
                    </li>
                    <li>
                        <a class="panel-refresh" href="#">
                            <i class="fa fa-refresh"></i> <span>Recargar</span>
                        </a>
                    </li>
                    <li>
                        <a class="panel-expand" href="#">
                            <i class="fa fa-expand"></i> <span>Fullscreen</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <table id="segmentoTable" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Segmento</th>
                    <th>Eventos</th>
                    <th>Inscriptos</th>
                    <th style="min-width: 95px"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
{% endblock %}
{#% block otherStylesheets %}
    <link rel="stylesheet" href="{{ asset('bundles/common/plugins/sweetalert/lib/sweet-alert.css' ) }}" />
    <link rel="stylesheet" href="{{ asset('bundles/common/css/hackjQueryUi.css' ) }}" />
{% endblock %#}


{% block otherJavascripts %}
    {#
    <script src="{{ asset('bundles/common/plugins/tableExport/tableExport.js') }}"></script>
    <script src="{{ asset('bundles/common/plugins/tableExport/jquery.base64.js') }}"></script>
    <script src="{{ asset('bundles/common/plugins/tableExport/jspdf/libs/sprintf.js') }}"></script>
    <script src="{{ asset('bundles/common/plugins/tableExport/jspdf/jspdf.js') }}"></script>
    <script src="{{ asset('bundles/common/plugins/tableExport/jspdf/libs/base64.js') }}"></script>
    <script src="{{ asset('bundles/common/plugins/sweetalert/lib/sweet-alert.min.js' )}}"></script>
    #}
    <script>
        (function ($) {
            "use strict";
            // no se sobreescribe el namespace, si ya existe
            var _table;
            $.Segmento = $.Segmento || {};
            $.Segmento.init = function() {
                //$(".pop").popover({offset: 10,html: true,delay: { show: 50, hide: 25 }});
                _table = $('#segmentoTable').dataTable( {
                    "processing": true,
                    "serverSide": true,
                    "ajax": {
                        "url": '{{ path('segmento_list_datatable') }}',
                        "type": 'POST'
                    },
                    "language" : {
                        "url" : "{{ asset('assets/common/Spanish.json') }}"
                    },
                    "columns": [
                        { "data": "id" },
                        { "data": "segmento" },
                        { "data": "eventos" },
                        { "data": "inscriptos" },
                        { "data": "actions" }
                    ],
                    "bLengthChange" : true,
                    "bFilter" : true,
                    "order": [[ 1, 'asc' ]],
                    "pageLength" : 25,
                    "columnDefs": [
                        {
                            "searchable": false,
                            "orderable": false,
                            "targets": [4]
                        }
                    ],
                    "fnCreatedRow": function( nRow, aData, iDataIndex ) {
                        if ( aData.dni == "0" )
                            $(nRow).addClass( 'info' );
                        return nRow;
                    },
                    "fnDrawCallback": function(oSettings, json) {
                        
                        //$('[data-toggle="popover"]').popover();
                        //$input = $('#list_users_filter input');
                        //if ($input.val().length>0) {
                        //    $('#list_users tbody td').each(function(){
                        //        $td=$(this);
                        //        if ($td.text().toUpperCase().indexOf($input.val().toUpperCase())>-1) {
                        //            $td.html($td.text().toUpperCase().replace($input.val().toUpperCase(),'<span class="occurrence">'+$input.val().toUpperCase()+'</span>'))
                        //        }
                        //    });
                        //}
                        //$.Usuario.charts(_table.ajax.json().cantUsers);
                    }       
                });
            }
            //$.Default.inscripto = function(){}
            $.Segmento.newModal = function(url){
                $.Segmento.openAjaxModal(url,'Nuevo Segmento');
            }
            $.Segmento.editModal = function(url){
                $.Segmento.openAjaxModal(url,'Editar Segmento');
            }
            $.Segmento.openAjaxModal = function(url,title){
                $.Main.openFormModal(url,title, function(){
                        $('#panel-config form').submit(function(event){
                            $('#segmentoTable').parents('panel').block($.Main.defaultBlockConf());
                            $('#okButton').button('loading')
                            event.preventDefault();
                            $.post(url, $('#panel-config form').serialize(), function(data){
                                if(data.success){
                                    toastr['success'](data.message, 'Excelente!');
                                    _table.fnDraw(true);
                                    $.Main.closeFormModal();
                                }else if(data.error){
                                    toastr['error'](data.message, 'Cuidado!');
                                }else{
                                    $("#panel-config form").html($(data).find('form').html());
                                    toastr['warning']('Aún tiene campos obligatorios sin llenar o con datos erroneos.', 'Cuidado!');
                                }
                                $('#okButton').button('reset');
                                $('#segmentoTable').parents('panel').unblock();
                            });
                        });
                    }
                );                
                //$.Main.openModal(url,"Nuevo Segmento");
            }
            //$.Default.inscripto.editModal = function(url){
            //    $('#okButton').button('reset');
            //    $('#panel-config .modal-footer').show();
            //    $('#panel-config .modal-title').html("Editar Inscripto");
            //    $('#panel-config .modal-body').html("");
            //    $('#panel-config .modal-body').load(url)
            //    $('#panel-config').modal();                 
            //}            
            //$.Default.inscripto.deleteModal = function(url){
            //    jQuery.get(url, function(data){
            //        swal({
            //            title: "Seguro quiere eliminar la planilla?",
            //            text: "Los cambios serán permanetes!<div id='deleteFormAux' class='hidden'>"+data+"</div>",
            //            type: "warning",
            //            showCancelButton: true,
            //            confirmButtonColor: "#DD6B55",
            //            confirmButtonText: "Si, eliminar!",
            //            cancelButtonText: "No, cancelar!",
            //            closeOnConfirm: false,
            //            closeOnCancel: true,
            //            html: true
            //        },
            //        function (isConfirm) {
            //            if (isConfirm) {
            //                $('#deleteFormAux form').submit();
            //                swal("Excelente!", "La planilla de inscripto fue borrada.", "success");
            //            }
            //        });
            //    });
            //}            
            //$.Default.autocomplete = function(){}
            //$.Default.autocomplete.getData = function(municipio,tipo){
            //    try {
            //        return instituciones[municipio][tipo];
            //    }
            //    catch(err) {
            //        return null
            //    }
            //}
        })(jQuery);
        $(document).ready(function(){$.Segmento.init();/*$.TableExport.init()*/});
        
//        (function ($) {
//            var exportTable = "#inscripcionTable";
//            var ignoreColumn = 6;
//            // no se sobreescribe el namespace, si ya existe
//            $.TableExport = $.TableExport || {};
//            $.TableExport.init = function() {
//                $(".export-pdf").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'pdf',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});
//				$(".export-excel").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'excel',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});
//				$(".export-doc").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'doc',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});
//				$(".export-csv").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'csv',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});
//				$(".export-txt").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'txt',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});
//				$(".export-sql").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'sql',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});
//				$(".export-json").on("click", function(e) {
//					e.preventDefault();
//					$(exportTable).tableExport({
//						type: 'json',
//						escape: 'false',
//						ignoreColumn: '['+ignoreColumn+']'
//					});
//				});                
//            }
//        })(jQuery);  
    </script>
{% endblock %}